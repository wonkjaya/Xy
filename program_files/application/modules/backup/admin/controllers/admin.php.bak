<?php

class Admin extends CI_Controller{

	function __construct(){
		parent::__construct();
		$this->load->model('model_admin','madmin');
		$this->load->helper('date');
	}
	
	function index(){
		echo 'hore';
	}
	
	function un(){
		unset_userdata();
		redirect('admin/login');
	}
	
	function login(){
		$data=array();
		check_login(); // jika sudah login maka otomatis redirect ke dashboard [user_helper.php] 
		//echo $this->session->get_userdata('language');exit;
		$this->load->helper(array('form','loader'));
		$config = array(
			array(
					'field' => 'username',	'label' => 'Username',	'rules' => 'required'
			),
			array(
					'field' => 'password',	'label' => 'Password',	'rules' => 'required'
			)
		);
		$fv = form_validasi($config); //load form validation [loader.php]
		/* return
			TRUE = semua validasi complete
			FALSE = jika salah atau belum submit
		*/
		if ($fv == TRUE){
			if($this->madmin->login() != false){
				redirect('admin/dashboard');
			}else{
				$data['login_error']=cur_lang('login','login_error',false);
			}
		}
		$data['title']='Login';
		head($data);
		$this->load->view('login',$data);
	}
	// 28 jun 15
	function register(){
		$data=array();
		check_login(); // jika sudah login maka otomatis redirect ke dashboard [user_helper.php] 
		$fv=false;
		if($_GET){
			$reg=$this->madmin->register(); // check validation;
			if($reg == true)
				echo cur_lang('login','register_success');
			else
				echo cur_lang('login','register_error');
		}else{
			//echo $this->session->get_userdata('language');exit;
			$this->load->helper(array('form','loader'));
			/*$config = array(
				array(
						'field' => 'user_email',	'label' => 'Email',	'rules' => 'required'
				),
				array(
						'field' => 'user_login',	'label' => 'Username',	'rules' => 'required'
				),
				array(
						'field' => 'user_pass',	'label' => 'Password',	'rules' => 'required'
				),
				array(
						'field' => 'pass_confirm',	'label' => 'Confirm',	'rules' => 'required|matches[user_pass]'
				)
			);
			$fv = form_validasi($config);*/ //load form validation [loader.php]
			/* return
				TRUE = semua validasi complete
				FALSE = jika salah atau belum submit
			*/
			if ($fv == TRUE){
				if($this->madmin->register() != false){
					redirect('admin/complete_configuration');
				}else{
					$data['login_error']=cur_lang('login','login_error',false);
				}
			}
			$data['title']='Register';
			head($data);
			$this->load->view('register',$data);
		}
	}
	
	// created for 26 jun 15
	function forgotPassword($email=''){
		$data=$this->madmin->forgotPassword(str_replace(':at:','@',$email));
		echo $data;
	}
	
	function check_validation($type='email'){ 
		if($type == 'email'){
			if(trim('@',$_GET['email']))
				echo '<i class="glyphicon glyphicon-remove" style="color:red"></i>';
			else
				echo '<i class="glyphicon glyphicon-ok" style="color:green"></i>';
		}elseif($type == 'fullname'){
			if(strlen($_GET['fullName']) < 2) 
				echo '<i class="glyphicon glyphicon-remove" style="color:red"></i>';
			else
				echo '<i class="glyphicon glyphicon-ok" style="color:green"></i>';
		}elseif($type == 'address'){
			$address=$_GET['address'];
			if(strlen($address) < 6)
				echo '<i class="glyphicon glyphicon-remove" style="color:red"></i>';
			else
				echo '<i class="glyphicon glyphicon-ok" style="color:green"></i>';
		}else{
			echo '<i class="glyphicon glyphicon-remove" style="color:red"></i>';
		}
	}
	
	// PAGES
	// created 12 jul 15
	function dashboard(){
		$data=array(
			'title'=>"Dashboard",
			'segment'=>'segment_home_dashboard'
		);
		template_view($data,'dashboard',true,true);
	}
	
	// S E G M E N T S
	// created 12 jul 15
	
	function segment_home_dashboard(){
		echo 'ad';
	}




}
?>